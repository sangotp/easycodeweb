@using Microsoft.AspNetCore.Identity
@using EasyCodeAcademy.Web.Models
@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewData["Title"]</title>

    <link rel="icon" type="image/x-icon" href="/Assets/img/favicon.ico" />

    @*Site CSS*@
    <link rel="stylesheet" type="text/css" href="~/Assets/css/site.css" />

    @*Layout CSS*@
    <link rel="stylesheet" type="text/css" href="~/EasyCodeAcademy.Web.styles.css" />

    @*Font Awesome Kit*@
    <script src="https://kit.fontawesome.com/342629dbfe.js" crossorigin="anonymous"></script>

    @*Bootstrap 5*@
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    @*SummerNote*@
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
</head>
<body>
    <div id="main">
        <div id="header">
            <div class="header__container">
                <div class="nav-bar">
                    <div class="nav-bar__brand">
                        <a href="/" class="brand-home">EasyCode</a>
                    </div>
                    <div class="nav-bar__action ml-64">
                        <ul class="action-list">
                            <li class="action-list__item">
                                <a href="/courses" class="action-link">Courses</a>
                            </li>
                            <li class="action-list__item ml-64">
                                <button type="button" class="action-btn btn-restart">Activities</button>
                                <ul class="subnav-list">
                                    <li class="subnav-list__item">
                                        <a href="/activities/challenge" class="subnav-link">Challenges</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="action-list__item ml-64">
                                <button type="button" class="action-btn btn-restart">References</button>
                                <ul class="subnav-list">
                                    <li class="subnav-list__item">
                                        <a href="/documentation" class="subnav-link">Documentation</a>
                                    </li>
                                </ul>
                            </li>
                            @{
                                if (UserManager.GetUserId(User) != null)
                                {
                                    var user = await UserManager.FindByIdAsync(UserManager.GetUserId(User));
                                    var roles = await UserManager.GetRolesAsync(user);
                                    if (roles.Contains("Admin"))
                                    {
                                        <li class="action-list__item ml-64">
                                            <button type="button" class="action-btn btn-restart">Manage</button>
                                            <ul class="subnav-list">
                                                <li class="subnav-list__item">
                                                    @*                                        <a asp-page="/Manage/Index" class="subnav-link">Site</a>.
                                        <a asp-page="/Manage/User" class="subnav-link">User</a>*@
                                                    <a asp-page="/Manage/Index" class="nav-link text-dark text-no-wrap">Site</a>
                                                    <a asp-area="Admin" asp-page="/Role/Index" class="nav-link text-dark text-no-wrap">Role & User</a>
                                                </li>
                                            </ul>
                                        </li>
                                    }
                                }
                            }
                        </ul>
                    </div>
                    @*                    <div class="nav-bar__search ml-auto"><i class="fa-solid fa-magnifying-glass"></i></div>*@
                    <div class="ml-auto">@await Html.PartialAsync("_CartPartial")</div>
                    @*                    <div class="nav-bar__identify ml-32">
                    <a href="/Authentication/Register" class="user-signup">Sign Up</a>
                    <a href="/Authentication/Login" class="user-login ml-8">Log In</a>
                    </div>*@
                    @*                    <div class="nav-bar__inventory ml-auto"><a href="" class="link-restart site-link-hover"><i class="fa-solid fa-box-archive"></i></a></div>*@
                    <partial name="_LoginPartial" />
                    @*Menu Mobile*@
                    <div class="menu ml-auto">
                        <button type="button" id="menu-btn" class="btn-restart font-24"><i class="fa-solid fa-bars"></i></button>
                    </div>

                    @*Menu Modal*@
                    <div class="menu-modal">
                        <div class="menu-modal__header">
                            <div class="header-mobile-container">
                                <div class="nav-bar-mobile">
                                    <div class="nav-bar-mobile__brand"><a href="/" class="brand-mobile-home">EasyCode</a></div>
                                    <div class="nav-bar-mobile__close ml-auto">
                                        <button type="button" id="modal-close" class="btn-restart font-24"><i class="fa-solid fa-xmark"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="menu-modal__content">
                            <div class="modal-content-container">
                                <ul class="modal-list">
                                    <li class="modal-list__item">
                                        <a href="/courses" class="modal-action-link">Courses</a>
                                    </li>
                                    <li class="modal-list__item">
                                        <button type="button" id="sub-modal-activities" class="sub-modal-btn btn-restart">
                                            <span class="modal-action-btn__title">Activities</span>
                                            <i class="fa-solid fa-angle-right"></i>
                                        </button>
                                    </li>
                                    <li class="modal-list__item">
                                        <button type="button" id="sub-modal-references" class="sub-modal-btn btn-restart">
                                            <span class="modal-action-btn__title">References</span>
                                            <i class="fa-solid fa-angle-right"></i>
                                        </button>
                                    </li>
                                    @*                                    <li class="modal-list__item">
                                    <a asp-page="/Manage/Index" class="modal-action-link link-restart">Manage</a>
                                    </li>*@
                                    @{
                                        if (UserManager.GetUserId(User) != null)
                                        {
                                            var user = await UserManager.FindByIdAsync(UserManager.GetUserId(User));
                                            var roles = await UserManager.GetRolesAsync(user);
                                            if (roles.Contains("Admin"))
                                            {
                                                <li class="modal-list__item">
                                                    <button type="button" id="sub-modal-manage" class="sub-modal-btn btn-restart">
                                                        <span class="modal-action-btn__title">Manage</span>
                                                        <i class="fa-solid fa-angle-right"></i>
                                                    </button>
                                                </li>
                                            }
                                        }
                                    }
@*                                    <li class="modal-list__item mt-16">
                                        <a href="/Authentication/Register" class="signup-btn text-center">Sign Up</a>
                                    </li>
                                    <li class="modal-list__item mt-8">
                                        <a href="/Authentication/Login" class="login-btn text-center">Log In</a>
                                    </li>*@
                                </ul>
                            </div>
                        </div>
                        @*Sub Menu Modal*@
                        <div id="submenu-item-activities" class="submenu-modal__content">
                            <div class="submenu-modal-container">
                                <div class="submenu-return">
                                    <button type="button" class="submenu-return__btn btn-restart"><i class="fa-solid fa-angle-left mr-8"></i>Return</button>
                                </div>
                                <h1 class="submenu-header mt-16">Activities</h1>
                                <ul class="submenu-list mt-8">
                                    <li class="submenu-list__item">
                                        <a href="/activities/challenge" class="submenu-link">Challenges</a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        @*Sub Menu Modal*@
                        <div id="submenu-item-references" class="submenu-modal__content">
                            <div class="submenu-modal-container">
                                <div class="submenu-return">
                                    <button type="button" class="submenu-return__btn btn-restart"><i class="fa-solid fa-angle-left mr-8"></i>Return</button>
                                </div>
                                <h1 class="submenu-header mt-16">References</h1>
                                <ul class="submenu-list mt-8">
                                    <li class="submenu-list__item">
                                        <a href="/documentation" class="submenu-link">Documentation</a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        @*Sub Menu Modal*@
                        <div id="submenu-item-manage" class="submenu-modal__content">
                            <div class="submenu-modal-container">
                                <div class="submenu-return">
                                    <button type="button" class="submenu-return__btn btn-restart"><i class="fa-solid fa-angle-left mr-8"></i>Return</button>
                                </div>
                                <h1 class="submenu-header mt-16">Manage</h1>
                                <ul class="submenu-list mt-8">
                                    <li class="submenu-list__item">
                                        @*                                        <a asp-page="/Manage/Index" class="submenu-link">Site</a>
                                        <a asp-page="/Manage/User" class="submenu-link">User</a>*@
                                        <a asp-page="/Manage/Index" class="nav-link text-dark text-no-wrap">Site</a>
                                        <a asp-area="Admin" asp-page="/Role/Index" class="nav-link text-dark text-no-wrap">Role & User</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="content">
            @RenderBody()
        </div>
        <div id="footer">
            <div class="footer__container">
                <div class="footer-term">
                    <span class="footer-term__content">
                        <a href="" class="term-link">Terms & Conditions</a>
                    </span>
                    <span class="footer-term__content">
                        <a href="" class="term-link">Privacy Policy</a>
                    </span>
                    <span class="footer-term__content">
                        <a href="" class="term-link">Help</a>
                    </span>
                </div>
                <div class="footer-copyright">
                    <span class="footer-copyright__date">Copyright &copy; @DateTime.Now.ToString("yyyy") </span>
                    <span class="footer-copyright__from">EasyCode Academy</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    @RenderSection("Scripts", required: false)
    <script type="text/javascript">
        // Sticky navbar (header)
        // Catch Event When User Scroll Page
        window.addEventListener("scroll", function () {
            const navbar = document.querySelector('.nav-bar');
            // if scroll Y Direction > 0, then we trigger 'sticky' class
            navbar.classList.toggle('sticky-box-shadow', window.scrollY > 0);
        });

        // Dropdown navbar
        const actionBtns = document.querySelectorAll('.action-btn');
        actionBtns.forEach(item => {
            item.addEventListener("click", function () {
                if (item.nextElementSibling) {
                    const Dropdown = document.getElementsByClassName(item.nextElementSibling.className);
                    const thisDropdown = this.nextElementSibling;
                    if (!thisDropdown.classList.contains('show')) {
                        for (var i = 0; i < Dropdown.length; i++) {
                            Dropdown[i].classList.remove('show');
                        }
                    }
                    item.nextElementSibling.classList.toggle('show');
                }
            });
        });

        //Hide subnav when user click outside
        window.onclick = function (events) {
            if (!events.target.matches('.action-btn')) {
                const subnav = document.getElementsByClassName("subnav-list");
                for (var i = 0; i < subnav.length; i++) {
                    if (subnav[i].classList.contains('show')) {
                        subnav[i].classList.remove('show');
                    }
                }
            }
        };


        //Menu Modal
        const menuBtn = document.getElementById('menu-btn');
        menuBtn.addEventListener("click", function () {
            const menuModal = document.getElementsByClassName('menu-modal');
            if (!menuModal[0].classList.contains('show')) {
                menuModal[0].classList.add('show');

                // Remove Scroll When Trigger Modal
                document.body.style.overflow = "hidden";
                document.body.style.height = "100%";
            }
        });

        const modalClose = document.getElementById('modal-close');
        modalClose.addEventListener("click", function () {
            const menuModal = document.getElementsByClassName('menu-modal');
            if (menuModal[0].classList.contains('show')) {
                menuModal[0].classList.remove('show');

                // Restore Scroll When Close Modal
                document.body.style.overflow = "auto";
                document.body.style.height = "auto";
            }
        });

        //SubMenu Modal

        // Sub Menu Button
        const submenuBtns = document.querySelectorAll('.sub-modal-btn');
        // Main Modal Content
        const menuModalContent = document.querySelector('.menu-modal__content');

        submenuBtns.forEach(item => {
            item.addEventListener("click", function () {
                // if button have 'sub-modal-activities' id then we hide main modal content
                // and display activitiesItem. Else opposite for referencesItem
                if (item.id == 'sub-modal-activities') {
                    const activitiesItem = document.getElementById('submenu-item-activities');
                    if (activitiesItem) {
                        menuModalContent.classList.add('hide');
                        activitiesItem.classList.add('show');
                    }
                }
                else if (item.id == 'sub-modal-references') {
                    const referencesItem = document.getElementById('submenu-item-references');
                    if (referencesItem) {
                        menuModalContent.classList.add('hide');
                        referencesItem.classList.add('show');
                    }
                }
                else if (item.id == 'sub-modal-manage') {
                    const manageItem = document.getElementById('submenu-item-manage');
                    if (manageItem) {
                        menuModalContent.classList.add('hide');
                        manageItem.classList.add('show');
                    }
                }
            });
        });

        // Return Main Modal
        const returnBtn = document.querySelectorAll('.submenu-return__btn');
        returnBtn.forEach(item => {
            item.addEventListener("click", function () {
                const submenuItem = document.querySelectorAll('.submenu-modal__content');
                submenuItem.forEach(subItem => {
                    // if this subItem Contains Show Then We Remove it and Remove 'hide' class for main modal content
                    if (subItem.classList.contains('show')) {
                        subItem.classList.remove('show');
                        menuModalContent.classList.remove('hide');
                    }
                });
            });
        });
    </script>
</body>
</html>
